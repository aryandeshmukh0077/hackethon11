<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Crop Advisory System</title>
    <style>
        *{ margin:0; padding:0; box-sizing:border-box; font-family:Arial, sans-serif; }
        header{ position:fixed; top:0; width:100%; height:70px; background:#1b5e20; color:white; display:flex; justify-content:space-between; align-items:center; padding:0 40px; z-index:1000; }
        header button{ padding:8px 18px; background:#4CAF50; border:none; color:white; border-radius:6px; cursor:pointer; }
        .page{ padding-top:70px; }
        .hero{ height:80vh; background:url("https://images.unsplash.com/photo-1574943320219-553eb213f72d?w=1200&h=800&fit=crop") center/cover no-repeat; display:flex; justify-content:center; align-items:center; opacity: 80; color:white; text-align:center; }
        .hero div{ background:rgba(0,0,0,.45); padding:40px; border-radius:14px; }
        section{ padding:60px; text-align:center; }
        .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:25px; max-width:1100px; margin:auto; }
        .card{ background:#f4f7f4; border-radius:16px; overflow:hidden; box-shadow:0 10px 20px rgba(0,0,0,.15); cursor:pointer; transition:.3s; }
        .card:hover{ transform:translateY(-5px); }
        .card img{ width:100%; height:170px; object-fit:cover; }
        .card p{ padding:16px; font-weight:bold; color:#2e7d32; }
        .modal{ position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; justify-content:center; align-items:center; z-index:2000; }
        .modal.active{ display:flex; }
        .login-box{ background:white; padding:30px; width:340px; border-radius:14px; text-align:center; }
        .login-box input{ width:100%; padding:12px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
        .login-box button{ width:100%; padding:12px; background:#4CAF50; color:white; border:none; border-radius:6px; cursor:pointer; }
        .message{ position:fixed; top:90px; right:40px; background:#ffebee; color:#c62828; padding:14px 18px; border-radius:8px; display:none; z-index:3000; }
    </style>
</head>
<body>

<header>
    <h2>ðŸŒ± Smart Crop Advisory</h2>
    <div id="authBtnGroup">
        <button id="regBtn" onclick="openModal('registerModal')" style="background:transparent; border:1px solid white; margin-right:10px;">Register</button>
        <button id="loginBtn" onclick="openModal('loginModal')">Login</button>
    </div>
    <div id="userGroup" style="display:none;">
        <span id="welcomeMsg" style="margin-right:20px;"></span>
        <button onclick="handleLogout()" style="background:#c62828;">Logout</button>
    </div>
</header>

<div class="page">
    <section class="hero">
        <div>
            <h1>Smart Crop Advisory System</h1>
            <p>AI-powered solutions for modern farming</p>
        </div>
    </section>

    <section>
        <h2>Smart Farming Services</h2>
        <div class="grid">
            <div class="card" onclick="access('cropadvisory')"><img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6"><p>Crop Advisory</p></div>
            <div class="card" onclick="access('soilhealth')"><img src="https://images.unsplash.com/photo-1598514983318-2f64f8f4796c"><p>Soil Health</p></div>
            <div class="card" onclick="access('weather')"><img src="https://images.unsplash.com/photo-1501630834273-4b5604d2ee31"><p>Weather Advisory</p></div>
            <div class="card" onclick="access('seeds')"><img src="https://images.unsplash.com/photo-1605000797499-95a51c5269ae"><p>Buy Crop Seeds</p></div>
        </div>
    </section>
</div>

<div class="modal" id="loginModal">
    <div class="login-box">
        <h3>Login</h3>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPass" placeholder="Password">
        <button onclick="handleLogin()">Login</button>
        <p onclick="closeModal('loginModal'); openModal('registerModal')" style="cursor:pointer; color:#2e7d32; margin-top:10px;">New user? Register</p>
    </div>
</div>

<div class="modal" id="registerModal">
    <div class="login-box">
        <h3>Register</h3>
        <input type="text" id="regName" placeholder="Full Name">
        <input type="text" id="regPhone" placeholder="Phone">
        <input type="email" id="regEmail" placeholder="Email">
        <input type="password" id="regPass" placeholder="Password">
        <button onclick="handleRegister()">Create Account</button>
        <p onclick="closeModal('registerModal'); openModal('loginModal')" style="cursor:pointer; color:#2e7d32; margin-top:10px;">Back to Login</p>
    </div>
</div>

<div class="message" id="message">ðŸ”’ Please login first</div>

<script>
  const API_URL = "http://localhost:5000";

  // Check login state
  let isLoggedIn = localStorage.getItem("loggedIn") === "true";

  if (isLoggedIn) {
    document.getElementById("authBtnGroup").style.display = "none";
    document.getElementById("userGroup").style.display = "block";
    document.getElementById("welcomeMsg").innerText =
      "Hi, " + localStorage.getItem("userName");
  }

  function openModal(id) {
    document.getElementById(id).classList.add("active");
  }

  function closeModal(id) {
    document.getElementById(id).classList.remove("active");
  }

  /* ---------- REGISTER ---------- */
  async function handleRegister() {
    const data = {
      fullName: document.getElementById("regName").value,
      phone: document.getElementById("regPhone").value,
      email: document.getElementById("regEmail").value,
      password: document.getElementById("regPass").value,
    };

    try {
      const res = await fetch(`${API_URL}/api/auth/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await res.json();
      alert(result.message);

      if (res.status === 201) {
        closeModal("registerModal");
        openModal("loginModal");
      }
    } catch (err) {
      alert("Server connection failed");
    }
  }

  /* ---------- LOGIN ---------- */
  async function handleLogin() {
    const data = {
      email: document.getElementById("loginEmail").value,
      password: document.getElementById("loginPass").value,
    };

    try {
      const res = await fetch(`${API_URL}/api/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await res.json();

      if (res.ok) {
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userName", result.user.fullName);
        location.reload();
      } else {
        alert(result.message);
      }
    } catch (err) {
      alert("Server connection failed");
    }
  }

  function handleLogout() {
    localStorage.clear();
    location.reload();
  }

  function access(page) {
    if (!localStorage.getItem("loggedIn")) {
      const msg = document.getElementById("message");
      msg.style.display = "block";
      setTimeout(() => (msg.style.display = "none"), 2000);
      openModal("loginModal");
      return;
    }
    location.href = page + ".html";
  }
</script>

</body>
</html>